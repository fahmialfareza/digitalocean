---
- name: Set up Kubernetes Cluster with Nginx
  hosts: localhost
  connection: local
  tasks:
    - name: Configure kubectl with DigitalOcean Kubernetes Cluster
      shell: doctl kubernetes cluster kubeconfig save {{ CLUSTER_NAME }}
      environment:
        DIGITALOCEAN_ACCESS_TOKEN: "{{ lookup('env', 'DO_API_TOKEN') }}"
        CLUSTER_NAME: "{{ lookup('env', 'KUBERNETES_CLUSTER_NAME') }}"

    - name: Install Nginx Ingress Controller
      shell: |
        kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml
      environment:
        KUBECONFIG: "~/.kube/config"
